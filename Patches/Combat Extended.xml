<?xml version="1.0" encoding="utf-8"?>
<Patch>

  <!-- 
  HP tweaks: New HP =  Original HP - (1 layer + 2 layer HP)/3 (- 200 if Instantdestruction is off)
 -->
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Combat Extended</li>
    </mods>
    <match Class="PatchOperationSequence">
      <!-- CE Embrasure -->
      <operations>

        <li Class="PatchOperationConditional">
          <xpath>Defs/ThingDef[defName="CE_Embrasure"]/comps</xpath>
          <nomatch Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName="CE_Embrasure"]</xpath>
            <value>
              <comps />
            </value>
          </nomatch>
        </li>

        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="CE_Embrasure"]/comps</xpath>
          <value>
            <li Class="LayeredDestruction.CompProperties_LayeredDestruction">
              <NextLayerDef>CE_Embrasure_Destr_Rubble</NextLayerDef>
              <NextLayerDef_Alternative>CE_Embrasure_Destr_Climbable</NextLayerDef_Alternative>
            </li>
          </value>
        </li>

        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="CE_Embrasure"]/statBases</xpath>
          <value>
            <MaxHitPoints>250</MaxHitPoints>
          </value>
        </li>
      </operations>
    </match>
  </Operation>

  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Combat Extended Armory</li>
    </mods>
    <match Class="PatchOperationSequence">
      <operations>

				<li Class="PatchOperationConditional">
					<xpath>Defs/ThingDef[defName="CE_ReinforcedWall"]/comps</xpath>
					<nomatch Class="PatchOperationAdd">
						<xpath>Defs/ThingDef[defName="CE_ReinforcedWall"]</xpath>
						<value>
							<comps />
						</value>
					</nomatch>
				</li>
				
        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="CE_ReinforcedWall"]/comps</xpath>
          <value>
            <li Class="LayeredDestruction.CompProperties_LayeredDestruction">
              <NextLayerDef>CE_ReinforcedWall_Destr_Shootable</NextLayerDef>
              <NextLayerDef_Alternative>CE_ReinforcedWall_Destr_Climbable</NextLayerDef_Alternative>
              <doubleDowngradeChance>0.1</doubleDowngradeChance>
              <InstantFullDestructionChance>0</InstantFullDestructionChance>
            </li>
          </value>
        </li>

        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="CE_ReinforcedWall"]/statBases/MaxHitPoints</xpath>
          <value>
            <!--  New HP =  600 - (100 + 50)/3 - 200 -->
            <MaxHitPoints>350</MaxHitPoints>
          </value>
        </li>

        <li Class="PatchOperationAdd">
          <xpath>Defs/ThingDef[defName="CE_ReinforcedEmbrasure"]</xpath>
          <value>
            <comps Inherit="False">
              <li Class="LayeredDestruction.CompProperties_LayeredDestruction">
                <NextLayerDef>CE_ReinforcedEmbrasure_Destr_Rubble</NextLayerDef>
                <NextLayerDef_Alternative>CE_ReinforcedEmbrasure_Destr_Climbable</NextLayerDef_Alternative>
                <doubleDowngradeChance>0.1</doubleDowngradeChance>
                <InstantFullDestructionChance>0</InstantFullDestructionChance>
              </li>
            </comps>
          </value>
        </li>
      </operations>
    </match>
  </Operation>

</Patch>